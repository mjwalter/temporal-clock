<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sun Clock</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
  </head>
  <body>
    <div id="coordinates">
      <label for="latitude">Latitude:</label>
      <input type="text" id="latitude" value="38.907192">
      <label for="longitude">Longitude:</label>
      <input type="text" id="longitude" value="-77.036873">
    </div>
    <p>
      <button id="update-coordinates">Start</button>
    </p>
    <div id="sunrise-sunset"></div>
    <script>
      let dataFromApi = null;
      // Function to get sunrise/sunset data from API
      const fetchSunriseSunset = async (lat="38.907192", lng="-77.036873") => {
        const results = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lng}&formatted=0`);
        const data = await results.json();
        return data.results;
      }
      // Function to calculate temporal hour length
      const calculateTemporalHourLength = (sunrise, sunset) => {
        const sunriseDate = new Date(sunrise);
        const sunsetDate = new Date(sunset);
        const temporalHourLength = (sunsetDate - sunriseDate) / 12;
        return temporalHourLength / (60 * 60 * 1000);
      }
      // Function to calculate current temporal time
      const calculateCurrentTemporalTime = (sunrise, sunset) => {
        const sunriseDate = new Date(sunrise);
        const sunsetDate = new Date(sunset);
        const currentDate = new Date();
        const temporalHourLength = (sunsetDate - sunriseDate) / 12;
        // Make sure the hours are positive, between 0 and 24
        const temporalTime = (currentDate - sunriseDate) / temporalHourLength;
        return temporalTime < 0 ? temporalTime + 24 : temporalTime;
      }
      const formatTemporalTime = (temporalTime) => {
        const hoursSinceDawn = Math.floor(temporalTime);
        const hours = hoursSinceDawn < 18 ? hoursSinceDawn + 6 : hoursSinceDawn - 18;
        const minutes = Math.floor((temporalTime - hoursSinceDawn) * 60);
        const paddedHours = hours.toString().padStart(2, '0');
        const paddedMinutes = minutes.toString().padStart(2, '0');
        return `${paddedHours}:${paddedMinutes}`;
      }
      const tradTemporalTime = (temporalTime) => {
        const hoursSinceDawn = Math.floor(temporalTime);
        // Turn hour 0 into "First hour", 1 into "Second hour", etc.
        const hourNames = ["First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eighth", "Ninth", "Tenth", "Eleventh", "Twelfth"];
        // There are four watches of the night, each three hours long
        const watchNames = ["First", "First", "First", "Second", "Second", "Second", "Third", "Third", "Third", "Fourth", "Fourth", "Fourth"];
        return hoursSinceDawn < 12 ? `${hourNames[hoursSinceDawn]} hour` : `${watchNames[hoursSinceDawn - 12]} watch`;
      }
      document.addEventListener('DOMContentLoaded', async (event) => {
        const updateSunriseSunset = (data) => {
          document.getElementById('sunrise-sunset').innerHTML = `
            <p><strong>${tradTemporalTime(calculateCurrentTemporalTime(data.sunrise, data.sunset))}</strong></p>
            <p>${formatTemporalTime(calculateCurrentTemporalTime(data.sunrise, data.sunset))}</p>
          `;
        };

        // Update coordinates when the button is clicked
        document.getElementById('update-coordinates').addEventListener('click', async (event) => {
          let latitude = document.getElementById('latitude').value;
          let longitude = document.getElementById('longitude').value;
          dataFromApi = await fetchSunriseSunset(latitude, longitude);
          updateSunriseSunset(dataFromApi);
        });

        setInterval(() => updateSunriseSunset(dataFromApi), 1000);
      });
    </script>
  </body>
</html>
